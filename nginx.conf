server {
    listen 80;
    server_name nytspellingbeesolver.com www.nytspellingbeesolver.com;
    return 301 https://beekey.buzz$request_uri;
}
server {
    listen 80;
    server_name beekey.buzz www.beekey.buzz;
    return 301 https://$host$request_uri;
}
server {
    listen 443 ssl;
    server_name nytspellingbeesolver.com www.nytspellingbeesolver.com;
    # SSL Configuration
    ssl_certificate     /home/sjf/ssl/nytspellingbeesolver.com.cert.pem;
    ssl_certificate_key /home/sjf/ssl/nytspellingbeesolver.com.key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    return 301 https://beekey.buzz$request_uri;
}
server {
    listen 443 ssl;
    server_name beekey.buzz www.beekey.buzz box;
    # SSL Configuration
    ssl_certificate     /home/sjf/ssl/beekey.buzz.domain.cert.pem;
    ssl_certificate_key /home/sjf/ssl/beekey.buzz.private.key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    # Logging
    access_log /home/sjf/logs/nginx/sbb.access.log;
    error_log  /home/sjf/logs/nginx/sbb.error.log;

    # Root directory
    root /home/sjf/sbb/site;
    index index.html;
    autoindex off;

    error_page 400 403 404 500 502 503 /error/$status.html;
    location ~ ^/err/(400|403|404|500|502|503)\.html$ {
        internal;
    }

    location = /clue-archive/ { # no page number
      return 301 /clue-archive/1;
    }
    location = /clue/ { # no clue text
      return 301 /clue-archive/1;
    }
    location = /puzzle/ { # no puzzle date
      return 301 /puzzle-archive;
    }
    location / {
      try_files $uri $uri/ =404;
	    default_type text/html;
    }

    # Security Headers
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    #add_header Content-Security-Policy "default-src 'self'; script-src 'self' https://www.googletagmanager.com; style-src 'self'; img-src 'self'; connect-src 'self'; frame-src https://www.google.com";
    add_header Referrer-Policy "strict-origin-when-cross-origin";
    add_header Permissions-Policy "geolocation=(), microphone=(), camera=()";

    # Enable compression for text files.
    gzip on;
    gzip_types text/html text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    gzip_proxied any;
    gzip_vary on;
    gzip_min_length 1000;
    gzip_comp_level 5;

    location /static/ {
      expires 30d;
      add_header Cache-Control "public, max-age=2592000";
    }
}
